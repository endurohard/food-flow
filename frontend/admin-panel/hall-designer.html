<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î–∏–∑–∞–π–Ω–µ—Ä –∑–∞–ª–∞ - FoodFlow</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f7fa;
      color: #2c3e50;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .navbar {
      background: #ffffff;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e1e8ed;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: #5a6c7d;
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .menu-toggle:hover {
      background: #f5f7fa;
    }

    .nav-brand {
      font-size: 20px;
      font-weight: 700;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 20px;
      display: flex;
      gap: 20px;
      height: calc(100vh - 70px);
    }

    .sidebar-panel {
      width: 280px;
      background: #ffffff;
      border: 1px solid #e1e8ed;
      border-radius: 12px;
      padding: 20px;
      height: fit-content;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    }

    .panel-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .tool-section {
      margin-bottom: 24px;
    }

    .tool-label {
      font-size: 13px;
      font-weight: 600;
      color: #8b95a5;
      text-transform: uppercase;
      margin-bottom: 12px;
      display: block;
    }

    .tool-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .tool-item {
      aspect-ratio: 1;
      background: #f5f7fa;
      border: 2px solid #e1e8ed;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: grab;
      transition: all 0.3s;
      padding: 12px;
      user-select: none;
    }

    .tool-item:hover {
      background: #ffffff;
      border-color: #1e88e5;
      transform: scale(1.05);
    }

    .tool-item:active {
      cursor: grabbing;
    }

    .tool-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .tool-name {
      font-size: 11px;
      font-weight: 600;
      color: #5a6c7d;
      text-align: center;
    }

    .canvas-container {
      flex: 1;
      background: #ffffff;
      border: 1px solid #e1e8ed;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: auto;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    }

    .canvas-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e1e8ed;
    }

    .canvas-title {
      font-size: 20px;
      font-weight: 700;
      color: #2c3e50;
    }

    .canvas-controls {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: #1e88e5;
      color: white;
    }

    .btn-primary:hover {
      background: #1976d2;
    }

    .btn-secondary {
      background: #ffffff;
      color: #5a6c7d;
      border: 1px solid #e1e8ed;
    }

    .btn-secondary:hover {
      background: #f5f7fa;
    }

    .btn-danger {
      background: #e53935;
      color: white;
    }

    .btn-danger:hover {
      background: #c62828;
    }

    .canvas {
      position: relative;
      min-width: 1200px;
      min-height: 800px;
      background-image:
        linear-gradient(rgba(225, 232, 237, 0.3) 1px, transparent 1px),
        linear-gradient(90deg, rgba(225, 232, 237, 0.3) 1px, transparent 1px);
      background-size: 40px 40px;
      border: 2px dashed #e1e8ed;
      border-radius: 8px;
    }

    .table-element {
      position: absolute;
      background: #ffffff;
      border: 3px solid #1e88e5;
      border-radius: 12px;
      padding: 16px;
      cursor: move;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
      min-width: 100px;
      min-height: 100px;
    }

    .table-element:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      z-index: 10;
    }

    .table-element.selected {
      border-color: #43a047;
      background: rgba(67, 160, 71, 0.05);
      box-shadow: 0 0 0 4px rgba(67, 160, 71, 0.2);
    }

    .table-element.round {
      border-radius: 50%;
    }

    .table-element.square {
      border-radius: 8px;
    }

    .table-number {
      font-size: 24px;
      font-weight: 700;
      color: #2c3e50;
    }

    .table-seats {
      font-size: 13px;
      color: #5a6c7d;
      font-weight: 600;
    }

    .object-element {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: move;
      user-select: none;
      font-size: 48px;
      padding: 12px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .object-element:hover {
      background: rgba(30, 136, 229, 0.1);
      transform: scale(1.1);
    }

    .object-element.selected {
      background: rgba(67, 160, 71, 0.15);
      box-shadow: 0 0 0 3px rgba(67, 160, 71, 0.3);
    }

    .delete-btn {
      position: absolute;
      top: -12px;
      right: -12px;
      width: 28px;
      height: 28px;
      background: #e53935;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      z-index: 20;
      box-shadow: 0 2px 8px rgba(229, 57, 53, 0.4);
    }

    .table-element:hover .delete-btn,
    .object-element:hover .delete-btn {
      display: flex;
    }

    .properties-panel {
      width: 280px;
      background: #ffffff;
      border: 1px solid #e1e8ed;
      border-radius: 12px;
      padding: 20px;
      height: fit-content;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #5a6c7d;
      margin-bottom: 6px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 8px 12px;
      background: #ffffff;
      border: 1px solid #e1e8ed;
      border-radius: 6px;
      color: #2c3e50;
      font-size: 14px;
      transition: all 0.3s;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #1e88e5;
      box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
    }

    .color-picker {
      width: 100%;
      height: 40px;
      border: 1px solid #e1e8ed;
      border-radius: 6px;
      cursor: pointer;
    }

    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background: #ffffff;
      border: 1px solid #e1e8ed;
      border-radius: 12px;
      padding: 12px 20px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      display: none;
      animation: slideIn 0.3s ease-out;
    }

    .notification.show {
      display: block;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .hall-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .hall-btn {
      flex: 1;
      padding: 10px;
      background: #ffffff;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 13px;
    }

    .hall-btn:hover {
      border-color: #1e88e5;
    }

    .hall-btn.active {
      background: #1e88e5;
      color: white;
      border-color: #1e88e5;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-left">
      <a href="tables.html" class="menu-toggle" title="–ù–∞–∑–∞–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å—Ç–æ–ª–∞–º–∏">‚Üê</a>
      <div class="nav-brand">
        üé® –î–∏–∑–∞–π–Ω–µ—Ä –∑–∞–ª–∞
      </div>
    </div>
    <div class="canvas-controls">
      <button class="btn btn-secondary" onclick="clearCanvas()">
        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
      </button>
      <button class="btn btn-primary" onclick="saveLayout()">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <!-- Tools Sidebar -->
    <div class="sidebar-panel">
      <div class="panel-title">üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</div>

      <!-- Hall Selector -->
      <div class="tool-section">
        <label class="tool-label">–ó–∞–ª</label>
        <div class="hall-selector">
          <button class="hall-btn active" data-hall="main" onclick="switchHall('main')">
            –û—Å–Ω–æ–≤–Ω–æ–π
          </button>
          <button class="hall-btn" data-hall="vip" onclick="switchHall('vip')">
            VIP
          </button>
          <button class="hall-btn" data-hall="terrace" onclick="switchHall('terrace')">
            –¢–µ—Ä—Ä–∞—Å–∞
          </button>
        </div>
      </div>

      <!-- Tables -->
      <div class="tool-section">
        <label class="tool-label">–°—Ç–æ–ª—ã</label>
        <div class="tool-grid">
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="table" data-shape="round" data-seats="2">
            <div class="tool-icon">‚≠ï</div>
            <div class="tool-name">–ö—Ä—É–≥–ª—ã–π<br>2 –º–µ—Å—Ç–∞</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="table" data-shape="round" data-seats="4">
            <div class="tool-icon">‚≠ï</div>
            <div class="tool-name">–ö—Ä—É–≥–ª—ã–π<br>4 –º–µ—Å—Ç–∞</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="table" data-shape="square" data-seats="4">
            <div class="tool-icon">‚¨ú</div>
            <div class="tool-name">–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π<br>4 –º–µ—Å—Ç–∞</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="table" data-shape="rect" data-seats="6">
            <div class="tool-icon">‚ñ≠</div>
            <div class="tool-name">–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–π<br>6 –º–µ—Å—Ç</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="table" data-shape="rect" data-seats="8">
            <div class="tool-icon">‚ñ≠</div>
            <div class="tool-name">–î–ª–∏–Ω–Ω—ã–π<br>8 –º–µ—Å—Ç</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="table" data-shape="round" data-seats="10">
            <div class="tool-icon">‚≠ï</div>
            <div class="tool-name">–ë–æ–ª—å—à–æ–π<br>10 –º–µ—Å—Ç</div>
          </div>
        </div>
      </div>

      <!-- Objects -->
      <div class="tool-section">
        <label class="tool-label">–û–±—ä–µ–∫—Ç—ã</label>
        <div class="tool-grid">
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="object" data-icon="üö™">
            <div class="tool-icon">üö™</div>
            <div class="tool-name">–î–≤–µ—Ä—å</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="object" data-icon="ü™ü">
            <div class="tool-icon">ü™ü</div>
            <div class="tool-name">–û–∫–Ω–æ</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="object" data-icon="üåø">
            <div class="tool-icon">üåø</div>
            <div class="tool-name">–†–∞—Å—Ç–µ–Ω–∏–µ</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="object" data-icon="üñºÔ∏è">
            <div class="tool-icon">üñºÔ∏è</div>
            <div class="tool-name">–î–µ–∫–æ—Ä</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="object" data-icon="üí°">
            <div class="tool-icon">üí°</div>
            <div class="tool-name">–°–≤–µ—Ç</div>
          </div>
          <div class="tool-item" draggable="true" ondragstart="dragStart(event)" data-type="object" data-icon="üî•">
            <div class="tool-icon">üî•</div>
            <div class="tool-name">–ö–∞–º–∏–Ω</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Canvas -->
    <div class="canvas-container">
      <div class="canvas-header">
        <div class="canvas-title" id="canvasTitle">üèõÔ∏è –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª</div>
        <div class="canvas-controls">
          <button class="btn btn-secondary" onclick="exportLayout()">
            üì§ –≠–∫—Å–ø–æ—Ä—Ç
          </button>
        </div>
      </div>
      <div class="canvas" id="canvas" ondrop="drop(event)" ondragover="allowDrop(event)">
        <!-- Elements will be added here -->
      </div>
    </div>

    <!-- Properties Panel -->
    <div class="properties-panel">
      <div class="panel-title">‚öôÔ∏è –°–≤–æ–π—Å—Ç–≤–∞</div>
      <div id="propertiesContent">
        <div style="color: #8b95a5; text-align: center; padding: 40px 0;">
          –í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç<br>–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <span id="notificationText"></span>
  </div>

  <script>
    let currentHall = 'main';
    let layouts = JSON.parse(localStorage.getItem('hallLayouts') || '{}');
    let currentElement = null;
    let tableCounter = 0;
    let isDragging = false;
    let dragOffset = { x: 0, y: 0 };

    // Drag and drop from toolbar
    function dragStart(event) {
      const type = event.target.closest('.tool-item').dataset.type;
      const data = {
        type: type,
        shape: event.target.closest('.tool-item').dataset.shape,
        seats: event.target.closest('.tool-item').dataset.seats,
        icon: event.target.closest('.tool-item').dataset.icon
      };
      event.dataTransfer.setData('text/plain', JSON.stringify(data));
    }

    function allowDrop(event) {
      event.preventDefault();
    }

    function drop(event) {
      event.preventDefault();
      const data = JSON.parse(event.dataTransfer.getData('text/plain'));

      const canvas = document.getElementById('canvas');
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      if (data.type === 'table') {
        createTable(x, y, data.shape, parseInt(data.seats));
      } else if (data.type === 'object') {
        createObject(x, y, data.icon);
      }

      saveCurrentLayout();
    }

    function createTable(x, y, shape, seats) {
      tableCounter++;
      const table = document.createElement('div');
      table.className = `table-element ${shape}`;
      table.id = `table-${Date.now()}-${tableCounter}`;
      table.style.left = `${x}px`;
      table.style.top = `${y}px`;

      if (shape === 'rect') {
        table.style.width = seats === 6 ? '140px' : '180px';
        table.style.height = '100px';
      } else if (shape === 'round') {
        const size = seats <= 4 ? '100px' : seats <= 8 ? '120px' : '150px';
        table.style.width = size;
        table.style.height = size;
      } else if (shape === 'square') {
        table.style.width = '100px';
        table.style.height = '100px';
      }

      table.innerHTML = `
        <div class="table-number">${tableCounter}</div>
        <div class="table-seats">üë• ${seats}</div>
        <button class="delete-btn" onclick="deleteElement('${table.id}')">√ó</button>
      `;

      table.addEventListener('mousedown', startDrag);
      table.addEventListener('click', (e) => {
        if (!e.target.classList.contains('delete-btn')) {
          selectElement(table.id);
        }
      });

      document.getElementById('canvas').appendChild(table);
    }

    function createObject(x, y, icon) {
      const obj = document.createElement('div');
      obj.className = 'object-element';
      obj.id = `object-${Date.now()}`;
      obj.style.left = `${x}px`;
      obj.style.top = `${y}px`;
      obj.textContent = icon;

      obj.innerHTML += `<button class="delete-btn" onclick="deleteElement('${obj.id}')">√ó</button>`;

      obj.addEventListener('mousedown', startDrag);
      obj.addEventListener('click', (e) => {
        if (!e.target.classList.contains('delete-btn')) {
          selectElement(obj.id);
        }
      });

      document.getElementById('canvas').appendChild(obj);
    }

    function startDrag(event) {
      if (event.target.classList.contains('delete-btn')) return;

      isDragging = true;
      currentElement = event.currentTarget;

      const rect = currentElement.getBoundingClientRect();
      const canvasRect = document.getElementById('canvas').getBoundingClientRect();

      dragOffset.x = event.clientX - rect.left;
      dragOffset.y = event.clientY - rect.top;

      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDrag);

      currentElement.style.cursor = 'grabbing';
      event.preventDefault();
    }

    function drag(event) {
      if (!isDragging || !currentElement) return;

      const canvas = document.getElementById('canvas');
      const canvasRect = canvas.getBoundingClientRect();

      let x = event.clientX - canvasRect.left - dragOffset.x;
      let y = event.clientY - canvasRect.top - dragOffset.y;

      // Keep within canvas bounds
      x = Math.max(0, Math.min(x, canvas.offsetWidth - currentElement.offsetWidth));
      y = Math.max(0, Math.min(y, canvas.offsetHeight - currentElement.offsetHeight));

      currentElement.style.left = `${x}px`;
      currentElement.style.top = `${y}px`;
    }

    function stopDrag() {
      isDragging = false;
      if (currentElement) {
        currentElement.style.cursor = 'move';
        saveCurrentLayout();
      }
      document.removeEventListener('mousemove', drag);
      document.removeEventListener('mouseup', stopDrag);
    }

    function selectElement(elementId) {
      // Deselect all
      document.querySelectorAll('.table-element, .object-element').forEach(el => {
        el.classList.remove('selected');
      });

      const element = document.getElementById(elementId);
      if (!element) return;

      element.classList.add('selected');
      showProperties(element);
    }

    function showProperties(element) {
      const isTable = element.classList.contains('table-element');
      const props = document.getElementById('propertiesContent');

      if (isTable) {
        const tableNum = element.querySelector('.table-number').textContent;
        const tableSeats = element.querySelector('.table-seats').textContent.match(/\d+/)[0];

        props.innerHTML = `
          <div class="form-group">
            <label class="form-label">–ù–æ–º–µ—Ä —Å—Ç–æ–ª–∞</label>
            <input type="number" class="form-input" value="${tableNum}" onchange="updateTableNumber('${element.id}', this.value)">
          </div>

          <div class="form-group">
            <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç</label>
            <input type="number" class="form-input" value="${tableSeats}" onchange="updateTableSeats('${element.id}', this.value)">
          </div>

          <div class="form-group">
            <label class="form-label">–§–æ—Ä–º–∞</label>
            <select class="form-select" onchange="updateTableShape('${element.id}', this.value)">
              <option value="round" ${element.classList.contains('round') ? 'selected' : ''}>–ö—Ä—É–≥–ª–∞—è</option>
              <option value="square" ${element.classList.contains('square') ? 'selected' : ''}>–ö–≤–∞–¥—Ä–∞—Ç–Ω–∞—è</option>
              <option value="rect" ${element.classList.contains('rect') ? 'selected' : ''}>–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">–ü–æ–∑–∏—Ü–∏—è X</label>
            <input type="number" class="form-input" value="${parseInt(element.style.left)}" onchange="updatePosition('${element.id}', this.value, null)">
          </div>

          <div class="form-group">
            <label class="form-label">–ü–æ–∑–∏—Ü–∏—è Y</label>
            <input type="number" class="form-input" value="${parseInt(element.style.top)}" onchange="updatePosition('${element.id}', null, this.value)">
          </div>

          <button class="btn btn-danger" style="width: 100%; margin-top: 12px;" onclick="deleteElement('${element.id}')">
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
          </button>
        `;
      } else {
        props.innerHTML = `
          <div class="form-group">
            <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
            <input type="text" class="form-input" value="${element.textContent.trim()}" maxlength="2" onchange="updateObjectIcon('${element.id}', this.value)" style="font-size: 32px; text-align: center; height: 60px;">
          </div>

          <div class="form-group">
            <label class="form-label">–ü–æ–∑–∏—Ü–∏—è X</label>
            <input type="number" class="form-input" value="${parseInt(element.style.left)}" onchange="updatePosition('${element.id}', this.value, null)">
          </div>

          <div class="form-group">
            <label class="form-label">–ü–æ–∑–∏—Ü–∏—è Y</label>
            <input type="number" class="form-input" value="${parseInt(element.style.top)}" onchange="updatePosition('${element.id}', null, this.value)">
          </div>

          <button class="btn btn-danger" style="width: 100%; margin-top: 12px;" onclick="deleteElement('${element.id}')">
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
          </button>
        `;
      }
    }

    function updateTableNumber(elementId, value) {
      const element = document.getElementById(elementId);
      element.querySelector('.table-number').textContent = value;
      saveCurrentLayout();
    }

    function updateTableSeats(elementId, value) {
      const element = document.getElementById(elementId);
      element.querySelector('.table-seats').textContent = `üë• ${value}`;
      saveCurrentLayout();
    }

    function updateTableShape(elementId, shape) {
      const element = document.getElementById(elementId);
      element.className = `table-element ${shape}`;
      if (!element.classList.contains('selected')) {
        element.classList.add('selected');
      }
      saveCurrentLayout();
    }

    function updatePosition(elementId, x, y) {
      const element = document.getElementById(elementId);
      if (x !== null) element.style.left = `${x}px`;
      if (y !== null) element.style.top = `${y}px`;
      saveCurrentLayout();
    }

    function updateObjectIcon(elementId, icon) {
      const element = document.getElementById(elementId);
      const deleteBtn = element.querySelector('.delete-btn');
      element.textContent = icon;
      element.appendChild(deleteBtn);
      saveCurrentLayout();
    }

    function deleteElement(elementId) {
      const element = document.getElementById(elementId);
      if (element && confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?')) {
        element.remove();
        document.getElementById('propertiesContent').innerHTML = `
          <div style="color: #8b95a5; text-align: center; padding: 40px 0;">
            –í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç<br>–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
          </div>
        `;
        saveCurrentLayout();
        showNotification('üóëÔ∏è –≠–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω');
      }
    }

    function switchHall(hall) {
      currentHall = hall;

      // Update buttons
      document.querySelectorAll('.hall-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.hall === hall);
      });

      // Update title
      const titles = {
        main: 'üèõÔ∏è –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª',
        vip: '‚≠ê VIP –∑–∞–ª',
        terrace: '‚òÄÔ∏è –¢–µ—Ä—Ä–∞—Å–∞'
      };
      document.getElementById('canvasTitle').textContent = titles[hall];

      // Load layout
      loadLayout();
    }

    function saveCurrentLayout() {
      const canvas = document.getElementById('canvas');
      const elements = [];

      canvas.querySelectorAll('.table-element, .object-element').forEach(el => {
        const isTable = el.classList.contains('table-element');

        if (isTable) {
          elements.push({
            type: 'table',
            id: el.id,
            number: el.querySelector('.table-number').textContent,
            seats: el.querySelector('.table-seats').textContent.match(/\d+/)[0],
            shape: el.classList.contains('round') ? 'round' : el.classList.contains('square') ? 'square' : 'rect',
            x: parseInt(el.style.left),
            y: parseInt(el.style.top),
            width: el.style.width,
            height: el.style.height
          });
        } else {
          const icon = el.textContent.replace('√ó', '').trim();
          elements.push({
            type: 'object',
            id: el.id,
            icon: icon,
            x: parseInt(el.style.left),
            y: parseInt(el.style.top)
          });
        }
      });

      layouts[currentHall] = elements;
      localStorage.setItem('hallLayouts', JSON.stringify(layouts));
    }

    function loadLayout() {
      const canvas = document.getElementById('canvas');
      canvas.innerHTML = '';

      const layout = layouts[currentHall] || [];
      tableCounter = 0;

      layout.forEach(item => {
        if (item.type === 'table') {
          tableCounter = Math.max(tableCounter, parseInt(item.number));
          const table = document.createElement('div');
          table.className = `table-element ${item.shape}`;
          table.id = item.id;
          table.style.left = `${item.x}px`;
          table.style.top = `${item.y}px`;
          if (item.width) table.style.width = item.width;
          if (item.height) table.style.height = item.height;

          table.innerHTML = `
            <div class="table-number">${item.number}</div>
            <div class="table-seats">üë• ${item.seats}</div>
            <button class="delete-btn" onclick="deleteElement('${table.id}')">√ó</button>
          `;

          table.addEventListener('mousedown', startDrag);
          table.addEventListener('click', (e) => {
            if (!e.target.classList.contains('delete-btn')) {
              selectElement(table.id);
            }
          });

          canvas.appendChild(table);
        } else if (item.type === 'object') {
          const obj = document.createElement('div');
          obj.className = 'object-element';
          obj.id = item.id;
          obj.style.left = `${item.x}px`;
          obj.style.top = `${item.y}px`;
          obj.textContent = item.icon;

          obj.innerHTML += `<button class="delete-btn" onclick="deleteElement('${obj.id}')">√ó</button>`;

          obj.addEventListener('mousedown', startDrag);
          obj.addEventListener('click', (e) => {
            if (!e.target.classList.contains('delete-btn')) {
              selectElement(obj.id);
            }
          });

          canvas.appendChild(obj);
        }
      });

      document.getElementById('propertiesContent').innerHTML = `
        <div style="color: #8b95a5; text-align: center; padding: 40px 0;">
          –í—ã–±–µ—Ä–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç<br>–¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </div>
      `;
    }

    function clearCanvas() {
      if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∑–∞–ª? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        document.getElementById('canvas').innerHTML = '';
        layouts[currentHall] = [];
        localStorage.setItem('hallLayouts', JSON.stringify(layouts));
        tableCounter = 0;
        showNotification('üóëÔ∏è –ó–∞–ª –æ—á–∏—â–µ–Ω');
      }
    }

    function saveLayout() {
      saveCurrentLayout();
      showNotification('üíæ –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
    }

    function exportLayout() {
      const data = JSON.stringify(layouts, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `hall-layouts-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showNotification('üì§ –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞');
    }

    function showNotification(message) {
      const notification = document.getElementById('notification');
      const text = document.getElementById('notificationText');

      text.textContent = message;
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const selected = document.querySelector('.selected');
      if (!selected) return;

      if (e.key === 'Delete' || e.key === 'Backspace') {
        e.preventDefault();
        deleteElement(selected.id);
      }

      if (e.key === 'ArrowUp') {
        e.preventDefault();
        const y = parseInt(selected.style.top) - (e.shiftKey ? 10 : 1);
        selected.style.top = Math.max(0, y) + 'px';
        saveCurrentLayout();
      }

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        const y = parseInt(selected.style.top) + (e.shiftKey ? 10 : 1);
        selected.style.top = y + 'px';
        saveCurrentLayout();
      }

      if (e.key === 'ArrowLeft') {
        e.preventDefault();
        const x = parseInt(selected.style.left) - (e.shiftKey ? 10 : 1);
        selected.style.left = Math.max(0, x) + 'px';
        saveCurrentLayout();
      }

      if (e.key === 'ArrowRight') {
        e.preventDefault();
        const x = parseInt(selected.style.left) + (e.shiftKey ? 10 : 1);
        selected.style.left = x + 'px';
        saveCurrentLayout();
      }
    });

    // Initialize
    loadLayout();
  </script>
</body>
</html>
