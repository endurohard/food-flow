<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - FoodFlow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            min-height: 100vh;
        }

        .navbar {
            background: #ffffff;
            padding: 16px 20px;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .nav-brand {
            font-size: 20px;
            font-weight: 700;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #1e88e5;
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1e88e5;
            color: white;
        }

        .btn-primary:hover {
            background: #1976d2;
        }

        .btn-secondary {
            background: #f5f7fa;
            color: #2c3e50;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
        <div style="display: flex; gap: 12px;">
            <a href="index.html" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
            <a href="/customer-app/index.html" target="_blank" class="btn btn-secondary" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; text-decoration: none;">
                üåê –°–∞–π—Ç –∑–∞–∫–∞–∑–æ–≤
            </a>
        </div>
    </nav>

    <div class="container">
        <!-- Profile Info -->
        <div class="card">
            <h2 class="card-title">üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
            <div class="form-group">
                <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" class="form-control" id="username" value="operator1" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
                <input type="text" class="form-control" id="displayName" value="–û–ø–µ—Ä–∞—Ç–æ—Ä 1">
            </div>
            <div class="form-group">
                <label class="form-label">–†–æ–ª—å</label>
                <input type="text" class="form-control" id="role" value="–û–ø–µ—Ä–∞—Ç–æ—Ä" readonly>
            </div>
        </div>

        <!-- SIP Credentials -->
        <div class="card">
            <h2 class="card-title">üìû –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏</h2>

            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫</strong><br>
                –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="sip-enabled" checked>
                <label for="sip-enabled">–í–∫–ª—é—á–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="auto-launch" checked>
                <label for="auto-launch">–ó–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ</label>
            </div>

            <div class="form-group">
                <label class="form-label">SIP –î–æ–±–∞–≤–æ—á–Ω—ã–π –Ω–æ–º–µ—Ä *</label>
                <input type="text" class="form-control" id="sip-extension" placeholder="7779" value="7779">
                <small style="color: #6c757d; font-size: 12px;">–í–∞—à –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä –≤ PBX</small>
            </div>

            <div class="form-group">
                <label class="form-label">SIP –ü–∞—Ä–æ–ª—å *</label>
                <input type="password" class="form-control" id="sip-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="5TQNF_Srld">
                <small style="color: #6c757d; font-size: 12px;">–ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PBX</small>
            </div>

            <div class="form-group">
                <label class="form-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
                <input type="text" class="form-control" id="sip-displayName" placeholder="–û–ø–µ—Ä–∞—Ç–æ—Ä 1" value="–û–ø–µ—Ä–∞—Ç–æ—Ä 1">
                <small style="color: #6c757d; font-size: 12px;">–ò–º—è, –∫–æ—Ç–æ—Ä–æ–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ –∞–±–æ–Ω–µ–Ω—Ç—ã</small>
            </div>

            <h3 style="font-size: 16px; font-weight: 600; margin: 24px 0 16px 0;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

            <div class="form-group">
                <label class="form-label">SIP –°–µ—Ä–≤–µ—Ä</label>
                <input type="text" class="form-control" id="sip-server" placeholder="www.it005.ru" value="www.it005.ru">
            </div>

            <div class="form-group">
                <label class="form-label">–ü–æ—Ä—Ç</label>
                <input type="number" class="form-control" id="sip-port" value="5060">
            </div>

            <div class="form-group">
                <label class="form-label">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</label>
                <select class="form-control" id="sip-transport">
                    <option value="UDP" selected>UDP</option>
                    <option value="TCP">TCP</option>
                    <option value="WS">WebSocket</option>
                    <option value="WSS">WebSocket Secure</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">WebSocket URL (–¥–ª—è WS/WSS)</label>
                <input type="text" class="form-control" id="sip-wsUrl" placeholder="wss://www.it005.ru:8089/ws">
            </div>

            <div style="margin-top: 24px;">
                <button class="btn btn-primary" onclick="saveProfile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                <button class="btn btn-secondary" onclick="testConnection()">üîå –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
            </div>
        </div>

        <!-- Auto-launch Settings -->
        <div class="card">
            <h2 class="card-title">üöÄ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏</h2>

            <div class="checkbox-group">
                <input type="checkbox" id="show-panel" checked>
                <label for="show-panel">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–Ω–µ–ª—å –∑–≤–æ–Ω–∫–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ</label>
            </div>

            <div style="margin-top: 16px;">
                <button class="btn btn-secondary" onclick="manualLaunch()">üìû –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ–π—á–∞—Å</button>
            </div>
        </div>
    </div>

    <script src="js/telephony-autolaunch.js"></script>
    <script>
        // Load profile data
        function loadProfile() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);

                document.getElementById('username').value = user.username || '';
                document.getElementById('displayName').value = user.displayName || '';
                document.getElementById('role').value = user.role || '';

                if (user.sip) {
                    document.getElementById('sip-enabled').checked = user.sip.enabled !== false;
                    document.getElementById('sip-extension').value = user.sip.extension || '';
                    document.getElementById('sip-password').value = user.sip.password || '';
                    document.getElementById('sip-displayName').value = user.sip.displayName || user.displayName || '';
                    document.getElementById('sip-server').value = user.sip.server || 'www.it005.ru';
                    document.getElementById('sip-port').value = user.sip.port || 5060;
                    document.getElementById('sip-transport').value = user.sip.transport || 'UDP';
                    document.getElementById('sip-wsUrl').value = user.sip.wsUrl || '';
                }
            }

            // Load auto-launch settings
            document.getElementById('auto-launch').checked = localStorage.getItem('telephony_autolaunch') !== 'false';
            document.getElementById('show-panel').checked = localStorage.getItem('telephony_show_panel') === 'true';
        }

        // Save profile
        function saveProfile() {
            const user = {
                username: document.getElementById('username').value,
                displayName: document.getElementById('displayName').value,
                role: document.getElementById('role').value,
                sip: {
                    enabled: document.getElementById('sip-enabled').checked,
                    extension: document.getElementById('sip-extension').value,
                    password: document.getElementById('sip-password').value,
                    displayName: document.getElementById('sip-displayName').value,
                    server: document.getElementById('sip-server').value,
                    port: parseInt(document.getElementById('sip-port').value),
                    transport: document.getElementById('sip-transport').value,
                    wsUrl: document.getElementById('sip-wsUrl').value,
                    wsPassword: document.getElementById('sip-password').value
                }
            };

            localStorage.setItem('currentUser', JSON.stringify(user));

            // Save auto-launch settings
            const autoLaunch = document.getElementById('auto-launch').checked;
            localStorage.setItem('telephony_autolaunch', autoLaunch ? 'true' : 'false');

            const showPanel = document.getElementById('show-panel').checked;
            localStorage.setItem('telephony_show_panel', showPanel ? 'true' : 'false');

            alert('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!\n\n–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø—è—Ç –≤ —Å–∏–ª—É –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –∏–ª–∏ –ø–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏.');
        }

        // Test connection
        async function testConnection() {
            alert('üîå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...\n\n–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑—å —Å PBX —Å–µ—Ä–≤–µ—Ä–æ–º.');

            const config = {
                server: document.getElementById('sip-server').value,
                port: document.getElementById('sip-port').value,
                extension: document.getElementById('sip-extension').value
            };

            console.log('Testing connection:', config);

            // Simulate test
            setTimeout(() => {
                alert('‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω!\n\n–°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–µ—Ç–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.');
            }, 1500);
        }

        // Manual launch
        function manualLaunch() {
            saveProfile();

            if (window.telephonyLauncher) {
                telephonyLauncher.loadCurrentUser().then(() => {
                    telephonyLauncher.launchTelephony();
                });
            } else {
                alert('‚ö†Ô∏è Telephony launcher –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        }

        // Initialize
        loadProfile();
    </script>
</body>
</html>
